<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <title>OrganiCheck v1.0</title>
  <meta name="description" content="My Parse App">
  <meta name="viewport" content="width=device-width">
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.3.4.min.js"></script>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>

  <style type="text/css">
    body {
      min-height: 2000px;
      padding-top: 70px;
  }

  	/* !important */
	.active
	{
		font-weight: normal !important;
		text-decoration: underline !important;
	}
	/* Same-selector Overwriting */
	a.active
	{
	   font-weight: normal;
	}
  </style>

	<script id="check_template" type="text/html">
	    <div class="panel panel-default">
	            <div class="panel-heading" data-toggle="collapse" data-parent="#checksList" data-target="#collapse{{objectId}}" >
	                <h4 class="panel-title">
	                    {{entity}}   ($ {{amount}})
	                    <span class="pull-right clickable"><i class="glyphicon glyphicon-chevron-down"></i></span>
	                </h4>
	            </div>
	            <div id="collapse{{objectId}}" class="panel-collapse collapse in">
	                <div class="panel-body">
	                	<p>Banco: <b>{{bank}}</b>  - <i># {{number}}</i></p>
	                    <p>Fecha de emisi√≥n: <b>{{creationDateString}}</b></p>
	                    <p>Fecha de cobro: <b>{{withdrawalDateString}}</b></p>
	                </div>
			   		<div class="panel-footer">
						    <a class="btn btn-success" href="#"><span class="glyphicon glyphicon-ok"></span> </a>
						    <a class="btn btn-danger" href="#"><span class="glyphicon glyphicon-remove"></span> </a>
						    <a class="btn btn-warning" href="#"><span class="glyphicon glyphicon-trash"></span> </a>
			   		</div>
	            </div>
	     </div>
	</script>
</head>

<body>

  <!-- Fixed navbar -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand" href="/OrganiCheck/">OrganiCheck</a>
      </div>
    </div>
  </nav>
  
  <div id="main" class="container">

	<div id="dayWeekMonthBtnGroup" class="btn-group btn-group-justified" role="group" data-toggle="buttons">
		<label class="btn btn-primary active">
			<input type="radio" name="dayWeekMonthOptions" id="option1" autocomplete="off" checked value="Hoy"> Hoy
		</label>
		<label class="btn btn-primary">
			<input type="radio" name="dayWeekMonthOptions" id="option2" autocomplete="off" value="Semana"> Semana
		</label>
		<label class="btn btn-primary">
			<input type="radio" name="dayWeekMonthOptions" id="option3" autocomplete="off" value="Mes"> Mes
		</label>
	</div>
	<br />
    <div id="checkStatusBtnGroup" class="btn-group btn-group-justified" role="group" data-toggle="buttons" >
	  <label class="btn btn-info active">
	  	<span class="glyphicon glyphicon-pencil"> </span><br />
	    <input type="checkbox" autocomplete="off" checked> Emitido
	  </label>
	  <label class="btn btn-success">
	  	<span class="glyphicon glyphicon-ok"> </span><br />
	    <input type="checkbox" autocomplete="off"> Cobrado
	  </label>
	  <label class="btn btn-danger">
	  	<span class="glyphicon glyphicon-remove"> </span><br />
	    <input type="checkbox" autocomplete="off"> Rechazado
	  </label>
	  <label class="btn btn-warning">
	  	<span class="glyphicon glyphicon-trash"> </span><br />
	    <input type="checkbox" autocomplete="off"> Anulado
	  </label>
	</div>

    <br />
    <div id="dateRangeLabel">Mostrando cheques entre las fechas: <span id="queryStartDate"></span> y <span id="queryEndDate"></span></div>
    <br />
  	<div id="totalsByBank">
  	</div>
  	<div class="panel-group" id="checksList">
  	</div>
  </div>
  
  <script type="text/javascript">
    var parseAPPID = "3qX8M8V6VOIj2Hq82ZZLlcif6MgjzLPbGoniRJPc";
    var parseJSID = "gcpK88Zuud0KLK07vYNXJcFGaSNIM3n4RkN3oUxs";
    Parse.initialize(parseAPPID, parseJSID);

    /* global $,document,console,Parse */
    $(document).ready(function() {

	  // Hide date range label
	  $("#dateRangeLabel").hide();

	  var queryStartDate;
	  var queryEndDate;

      $('#dayWeekMonthBtnGroup input[name="dayWeekMonthOptions"]').change(function () {
   		 switch($(this).val()){
		  	case "Semana":
		  		queryStartDate = moment().locale("es").startOf('week');
		  		queryEndDate = moment().locale("es").endOf('week');
		  		break;
		  	case "Mes":
		  		queryStartDate = moment().locale("es").startOf('month');
		  		queryEndDate = moment().locale("es").endOf('month');
		  		break;
		  	case "Hoy":
		  	default:
			  	queryStartDate = queryEndDate = moment().locale("es");
		  		break;	
		  }
		  $("#queryStartDate").text(queryStartDate.format("dddd DD/MM/YYYY"));
		  $("#queryEndDate").text(queryEndDate.format("dddd DD/MM/YYYY"));
		  $("#dateRangeLabel").show();

	  });

      // Simple syntax to create a new subclass of Parse.Object. Creating Check class
      	var CheckObject = Parse.Object.extend("Check");
		var query = new Parse.Query(CheckObject);
		var view = {};
		query.find({
		  success: function(results) {
            
		    console.log("Successfully retrieved " + results.length + " scores.");
		    // Do something with the returned Parse.Object values
		    for (var i = 0; i < results.length; i++) { 
		      	var object = results[i];
		    	var template = document.getElementById("check_template").innerHTML;
		    	var objectJSON = object.toJSON();
		    	objectJSON.creationDateString = moment(object.get("creationDate")).format("DD/MM/YYYY");
		    	objectJSON.withdrawalDateString = moment(object.get("withdrawalDate")).format("DD/MM/YYYY");
				var output = Mustache.render(template, objectJSON);
				console.log(objectJSON);
				$("#checksList").append(output);
		    }
		    $('#checksList .in').collapse('hide'); // Collapse all panels
		  },
		  error: function(error) {
		    alert("Error: " + error.code + " " + error.message);
		  }
		});
		
  	});

  </script>
</body>
</html>